
<img src="https://github.com/Sergey1234Ovechkin/god_zilla/blob/master/img/123.png">
<img src="https://github.com/Sergey1234Ovechkin/god_zilla/blob/main/img/123.png">

God_zilla - редактор для создания коллажей и спрайтов.

Ссылка на редактор - онлайн: https://sergey1234ovechkin.github.io/god_zilla/index.html

Редактор работает онлайн с github, достаточно просто перейти по ссылке выше, также его можно скачать себе и запустить на локальном сервере, например на node.js


# Основные настройки, обзор панелей

После запуска редактора необходимо обязательно подключить основные модули, также можно изменить настройки по умолчанию при необходимости. 
Для подключения модулей - прокрутить страницу на самый низ кликнуть на вкладке "Загрузить модуль, изменить настройки" затем кнопку сохранить, после этого перезагрузить страницу.

После установки всех настроек можно приступить к созданию изображения. Размеры холста устанавливаются автоматически исходя из размера фонового изображения. 
Если изображение меньше экрана и параметр "littleCanvas" в настройках равен false размер холста будет равен размеру видимой части экрана. 
Для загрузки изображения с компьютера нажать зеленую кнопку с символом загрузки в правом верхнем углу .После загрузки изображения заданного размера, если в нем нет необходимости, его можно сделать прозрачным.нажав кнопку "Очистить фон".

Вкладка - "Масштаб, отражение фона" - изменение масштаба фоновой картинки, зеркальное отражение по какой либо оси, добавление сетки для более точного позиционирования.



В качестве подсказок, при наведении и удержании курсора мыши над большинством кнопок появляется краткое описание функции данной кнопки, на которые следует ориентироваться.

Для загрузки картинки нужно указать ее url (сервер на котором размещена картинка должен поддерживать crossorigin запросы), либо загрузить с компютера нажав кнопку load img.

После загрузки картинку можно масштабировать или отразить, по оси x, y или обоим направлениям.

Для начала работы нужно создать выделение (замкнутый контур) затем его можно отредактировать перемещая либо добавляя контрольные точки, либо сбросить и начать все заново. 

Выделенную область можно залить каким либо цветом, добавить ей прозрачность либо применить какой либо цветовой эффект, а также масштабировать, отразить и повернуть на какой либо градус.

Для искажения (масштабирования по точкам) выделенной области необходимо нажать кнопку "искажать", выбрать ось "xy", "x" или "у", затем перетаскивать точки в новое положение.

По оси "xy" для искажения используется библиотека <a href="https://chenxing.name/fun/imgwarp-js/">**imgwarp-js**</a>, добавление точек деформации - Ctrl+Click, удаление - Shift+Click.
После окончания деформации, для возвращения в обычный режим нужно нажать кнопку "Перемещать точку".


После всех манипуляций область можно скопировать в спрайт (создать спрайт), спрайт можно переместить в новое положение, создать с него отпечаток на фоновом изображении, спрайты также можно масштабировать, отражать и  вращать.

При работе со спрайтами часть кнопок скрывается, остаются только те которые можно применить к спрайтам. Чтобы вернуться к работе с фоновым изображением, созданию и редактированию контура нужно нажать на кнопку "работать с фоновым изображением".

Масштабирование спрайта идет от центра в обоих направлениях. 
При масштабировании и вращении спрайта, сначала считается масштабирование относительно начального размера, затем поворот относительно центра уже отмасштабированого спрайта.
Поворот также считается относительно начального градуса = 0.
При отражении спрайта убирается вращение затем производится отражение, затем вращается сново уже отраженным.
При масштабировании спрайта со скругленными углами если масштаб по оси x отличается от масштаба по оси y может появиться несовпадение контура и картинки спрайта.

При окончании работы спрайт можно сохранить в локальном хранилище нажав на кнопку Save, чтобы загрузить спрайт нажать "Показать сохраненные спрайты" => "создать"

Для сохранения спрайтов в спрайт-листы можно использовать модуль <a href="https://github.com/SergeyOvechkin/collage_n/blob/master/js/modules/spriteMatrix.js"> spriteMatrix </a>

Для искажения углов и создания 3d эффектов, можно использовать модуль <a href="https://github.com/SergeyOvechkin/collage_n/blob/master/js/modules/perspectiveTransform.js">  perspectiveTransform </a>

<p>
	Толщину линий обводки контура и цвет а также другие параметры, можно изменить в панели:  "Загрузить модуль, изменить настройки"				
	<ul>
		<li>Толщина обводки контура: lineWidth = 3;</li>
		<li>Цвет обвоки контура спрайтов: colorSpriteArea = "green";</li>
		<li>Цвет обводки  контура фона:  colorCommonArea = "red";</li>
		<li>Размер квадрата точки контура/2: halfPointSize = 5;</li>
		<li>Максимальное количество шагов назад при редактировании фона: backStepCounts = 3; </li>
		<li>Уменьшение холста относительно картинки: littleCanvas = false; true - если холст больше размера картинки уменьшает размер холста, false - рисует картинку в левом верхнем углу</li>
	    <li>Цвет разметочной сетки сетки экрана: grid_color = 0.5;</li>
		<li>Толщина сетки: grid_weight = "green";</li>
		<li>Шаг пикселей при движении области выделения стрелками клавиатуры: areaDistanceStep = 1;</li>
		<li>Cообщения в консоли: "showLogs" = true; </li>
        <li>Адрес фоновой картинки загружаемой по умолчанию: "imgSrc" = "./img/img.png" ; </li>	
	</ul>
</p>


# Работа с контуром выделения

Для начала выделения какой либо части изображения, либо создания произвольного контура необходимо создать замкнутый контур кликая по экрану мышью, затем соединить последний сегмент с нулевым. 
После того как контур будет замкнут его можно редактировать перетаскивая желтые квадраты по экрану мышью. 
Весь контур также можно двигать используя стрелки клавиатуры. В созданном контуре можно добавлять, удалять контрольные точки а также скруглять углы. 
Чтобы заново начать выделять область нажать кнопку "Сбросить выделение".

Манипуляции с выделенной областью
Выделенную контуром область можно масштабировать, вращать вокруг оси, отразить по какой либо оси вместе с изображением внутри нее. 
Область можно также залить каким либо цветом, либо сделать частично или полностью прозрачной, используя форму добавления изменения цвета - кнопка "Применить к выделению".

Например чтобы покрасить в красный: в первую ячейку ввести 255, вторую и третью 0, последнюю - (прозрачность) 255. 
Для манипуляции с цветом используется система RGBA где R - красный, G -зеленый, B - синий, A - прозрачность максимальное значение параметров 255. 
Если оставить ячейки пустыми - данные свойства затронуты не будут.


Увеличить или уменьшить интенсивность цвета можно используя формулу +=n, -=n, /=n, *=n где n - значение на которое будет увеличено, уменьшено свойство. 
Например чтобы увеличить красноватость на 20 ввести в первую ячейку +=20, остальные оставить пустыми, далее нажать "Применить к выделению".

<img src="https://github.com/Sergey1234Ovechkin/god_zilla/blob/main/img_study/8.png">


Для попиксельной работы с цветом используется форма "Применить функцию " В ней задаются условия для обработки каждого пикселя в выделенной области.
Например сделать прозрачным желтый: if (R>=200 && G >=200 && B <= 50){ A = 0; } что означает если величина красного и зеленого больше или равна 200, синего меньше или равна 50 - сделать данный пиксель прозрачным. 
Символ && - означает что второе условие не будет проверяться если первое не соответствует критериям, в данном случае должны совпасть все три условия тогда формула сработает, также есть знак || - что значит формула сработает если какое либо условие выполнится, например R будет равно 200. 
Оба знака можно использовать в одном условии, чередовать их как удобно при необходимости. Например покрасим красный и черный в белый: if (R>=200 && G >=200 && B <= 50 || R< = 50 && G <= 50 && B <= 50 ){ R = 255; G =255; B =255; A =255; } что означает если пиксель совпадет с одним из двух критериев его цвет сменится на белый. 
Данная форма удобна для вырезания сложного изображения с какого либо фона. Чтобы узнать цвет изображения в формате RGBA удобно использовать пипетку в дополнительных инструментах браузера.

<img src="https://github.com/Sergey1234Ovechkin/collagen_2/blob/main/img_study/10.png">


# Создание спрайта

Чтобы создать спрайт необходимо выделить замкнутый контур и нажать кнопку зеленого цвета "создать спрайт".
Спрайты также можно вращать, масштабировать, отражать, добавлять границу. 
Перетаскивать спрайты можно курсором мыши. 
Спрайты находятся в слоях, чтобы поднять спрайт на верхний слой необходимо нажать кнопу "слой up" на спрайте. 
Созданный спрайт можно удалить, скрыть, сохранить в локальном хранилище, отпечатать его изображение на фоновой картинке, рисовать им с помощью курсора мыши - кликая по холсту (кнопка "штамп курсор").

<img src="https://github.com/Sergey1234Ovechkin/god_zilla/blob/main/img_study/7.png">

Далее покрасим надпись Collagen рисунком фоновой картинки, для этого нажмем кнопку работать с фоном, выделим надпись и введем в форму следующие данные : if (R <=40 && G >=100 && B <= 20){ A = 0; }
Затем введем в форму if (A != 0){ R = 255; G =255; B= 255; A= 255 } чтобы сделать все непрозрачные пиксели белыми.
Далее создадим спрайт кнопка "создать спрайт" и перетащим его на область с фоновой картинкой. Затем нажмем кнопу "Штамп", скопируем контур спрайта на рабочую область - кнопка "Copy contur" и преключимся на фон - "Работать с фоном", затем сделаем прозрачным белый : if(R+B+G >= 750){A=0;} 
Далее создадим новый спрайт и очистим фон - "очистить фон".
Теперь у нас есть спрайт надпись которого была скопирован с изображения фоновой картинки. Сохраним спрайт - кнопка "save", перезагрузим страницу. Заново создадим сохраненный спрайт - кнопка "Показать сохраненные спрайты" -> "создать", спрайт появится на экране в том-же месте.

<img src="https://github.com/Sergey1234Ovechkin/god_zilla/blob/main/img_study/11.png">
<img src="https://github.com/Sergey1234Ovechkin/god_zilla/blob/main/img_study/6.png">
<img src="https://github.com/Sergey1234Ovechkin/god_zilla/blob/main/img_study/5.png">


# Деформация части изображения

Выделенный контур можно растянуть или сжать по какой либо оси вместе с изображением внутри него - для этого необходимо кликнуть "искажать", выбрать ось x или y затем перетаскивать контрольные точки. 
После завершения деформации нажать кнопку "Перемещать точку".
Для деформации по обеим осям "ху" создать три или более оси деформации кликая внутри области мышью с зажатой клавишей Ctrl, затем перетаскивать появившиеся круги для деформации изображения.
Удаление точек - Shift+Click.

<img src="https://github.com/Sergey1234Ovechkin/god_zilla/blob/main/img_study/2.png">
<img src="https://github.com/Sergey1234Ovechkin/god_zilla/blob/main/img_study/1.png">


# Сегментные спрайты

Вкладка сегментные спрайты используется для создания составных сегментов.

После клика на вкладке необходимо кликами мыши добавлять сегменты кликая по экрану.
Новый сегмент добавляется к последней точке.
Чтобы добавить новый сегмент к другой точке - ввести индекс точки (2) в форму после кнопки "add", затем продолжить кликать по экрану. 
Кнопка add - переключает форму с режима добавления новых точек в режим перемещения точек мышю. Удалить ненужный сегмент можно по его индексу - кнопка remove. Спрайт можно вращать или отпечатать на фоновом изображении - кнопка draw. 
Можно также изменить толщину и цвет обводки - кнопка "apply". 
Заново рисовать сегменты - кнопка "reset". 
Передвигать спрайт можно стрелками клавиатуры. 
Шаг передвижения (скорость) можно регулировать изменив значения первой формы (рядом с кнопкой add).


<img src="https://github.com/Sergey1234Ovechkin/god_zilla/blob/main/img_study/3.png">
<img src="https://github.com/Sergey1234Ovechkin/god_zilla/blob/main/img_study/4.png">

К контрольным точкам также можно привязывать спрайты, для создания марионеточного изображения.
Для того чтобы привязать спрайт к контрольной точке необходимо ввести его id в поле формы  рядом с кнопкой "add sprite",
после чего нажать на нее, спрайт добавится к скелету и будет двигаться при передвижении контрольной точки.
Контрольной точке с индексом 0 - спрайт добавить нельзя. Один и тот-же спрайт можно использовать для повторяющихся сегментов.

Сегментные спрайты можно сохранять в локальном хранилище кнопка "save".
После загрузки сегментного спрайта с компъютера нобходимо загрузить привязанные к нему спрайты.
Спрайты также можно сохранять в проект для автоматической загрузки.

<img src="https://github.com/Sergey1234Ovechkin/god_zilla/blob/main/img_study/sprite_bones.png">

# Рисование

Для рисования использовать панель - "Рисовать".

# Добавление текста

Для добавления текста можно использовать форму - "Добавить текст спрайту, фоновому изображению" внизу экрана. 
Порядок действий: добавить ссылку на шрифты - кнопка "Добавить шрифты", выбрать размер и стиль шрифта, координаты на холсте, ввести текст, затем нажать "Добавить текст". 
Текст также можно добавлять непосредственно в спрайты - выделенному спрайту.



# Складывание и вычитание изображений, обтравочные маски


Collagen позволяет использовать спрайты как обтравочные маски либо делать другие операций с фоновой картинкой. 


Отпечатаем изображение облаков, перенеся зеленый цвет с облаков на фоновою картинку.
Для этого создадим спрайт с изображением облаков, затем введем в форму "Применить функцию" следующие данные:


if(R1+G1+B1>500)G = (R1+G1+B1)/3; 
где R1,G1,B1,A1 - параметры цвета спрайта, R, G, B, A - параметры цвета фоновой картинки 

Далее нажмем кнопку "Применить к выделению". На фоне отобразится силует облаков, зеленые пиксели которого будут ввзяты с изображения спрайта.

<img src="https://github.com/Sergey1234Ovechkin/god_zilla/blob/main/img_study/123.png">
<img src="https://github.com/Sergey1234Ovechkin/god_zilla/blob/main/img_study/124.png">

A = (R1+G1+B1)/3;


<img src="https://github.com/Sergey1234Ovechkin/god_zilla/blob/main/img_study/125.png">

A = 255-(R1+G1+B1)/3;

<img src="https://github.com/Sergey1234Ovechkin/god_zilla/blob/main/img_study/126.png">



# Работа с контуром в форме применить функцию 

<img src="https://github.com/Sergey1234Ovechkin/god_zilla/blob/main/img_study/230.png">

Для обработки контура в пикселях после добавления условий поставить галочку в чекбокс "установить толщину в пикселях".
Затем установить толщину границы, выбрать направление, наружу или внутрь контура. Далее установить количество итераций, и шаг итерации в пикселях.
Нажать кнопку "применить к границе выделения", дождатьсься пока процессор обработает  изображение, 
это может занять какое-то количество времени, в зависимомти от площади обрабатываемого кадра. 

<img src="https://github.com/Sergey1234Ovechkin/god_zilla/blob/main/img_study/229.png">

<img src="https://github.com/Sergey1234Ovechkin/god_zilla/blob/main/img_study/301.png">


<img src="https://github.com/Sergey1234Ovechkin/god_zilla/blob/main/img_study/302.png">


# Создание анимации

<img src="https://github.com/Sergey1234Ovechkin/god_zilla/blob/main/img_study/400.png">

Для создания анимации необходимо создать спрайт, затем создать траекторию движения спрайта, для этого можно использовать обычный контур.
Далее нажать кнопку "code" на панели спрайтов, затем нажать "copy line", после чего в форме появится массив с координатами движения спрайта.
Первые два значения каждой контрольной точки это координаты X Y, третье текущий кадр спрайта. Поставить галочку на чекбокс events чтобы включить события.

Для создания анимации необходимо создать цикл

Цикл используется для рисования всех спрайтов, наримимер спрайта кнопки или спрайта управляемого клавиатурой вместе с анимацией движения 

Пример использования: 


    modules.animation = animationLop(sprites, 60) //создание цикла

  
		sprites.sprite_id.moveByLine( [ [120,50,0],[194,80,0],[253,89,0],[315,96,0]], 60, 1); 
        
		///  sprites -доступ ко всем спрайтам

    
Нажать кнопку "play".
	


После окончания работы с кодом анимации очистить форму, затем ввести:


		modules.animation.isOff = true;
		
Либо нажать кнопку stop  код выше сработает автоматически		
		
	

Пример использования с событиями: 


    animationLop(sprites, 60) //создание цикла

    sprites.sprite_button.click = function(){ //создание события клика
		sprites.sprite_id.moveByLine( [ [120,50,0],[194,80,0],[253,89,0],[315,96,0]], 60, 0); 
    }
	
	sprites.sprite_1233.keydown = function(key){ if(key == "s")sprites.sprite_1233.move(0, 3) }



Нажать кнопку "play".
	
Цикл будет неприрывно рисовать все спрайты, при клике кнопки sprite_button включится анимация второго спрайта, а при клике на копку "s" клавиатуры - спрайт передвинется на 3px вниз 



При нажании кнопки "play" передыдущий цикл, если он был включен как  modules.animation выключается автоматически;



**Отключение цикла:** 

modules.animation = animationLop(sprites, 60);

modules.animation.isOff = true; устанавливаем true для отключения цикла



Временные переменные можно сохранять в объекте modules 

	**Свойства спрайтов**

	**sprite_name.show** = false; сделать спрайт невидимым

	**sprite_name.width** - ширина спрайта

	**sprite_name.height** - высота спрайта


  **Таже доступны функции:**

  **sprite_name.nextFrame(index), prevFrame(index)** - следующий, предыдущий фрейм либо фрейм по индексу; 
  
  **sprite_name.render("common")** - отрисовка спрайта "common"- убирает отрисовку контура 
  
  **sprite_name.render_()** - более быстрый способ отрисовки спрайта, не рисует текст, границу и контур (используется в функциях ниже)
  
  **sprite_name.move(x, y)** - движение спрайта относительно позиции на указанное расстояние
  
  **sprite_name.moveCenter(x, y)** - передвижение спрайта центром в указанную точку
  
  **sprite_name.moveConer(x, y,  bottom)** - передвижение спрайта левым верхним углом в указанную точку  bottom - true - нижним
  
  **sprite.rotateFi(fi)**  - вращение спрайта градусы
  
  **sprite.scale(coeff_x, coeff_y)** - масштабирует спрайт по коэффициентам 
  
  **sprite.moveByLine([[87,450,0],[95,443,0],[100,437,0]....], speed,...... positionSprite, callb, option)**;
  speed - скорость (например 60), positionSprite, callb, option - необязательные параметры, 
  где positionSprite движение относительно: центра - 0; нижнего левого угла - 1;
  callb - функция обратного вызова при окончании анимации; option - какие либо параметры которые будут в нее переданы - callb(option);


**События:**

Для включения событий отметить чекбокс **events**

**sprite_name.click** = function(point){ } - добавить событие клика спрайту  
где  point координаты клика

**sprite_name.keydown** = function(key){} - добавить событи нажатия кнопки клавиатуры
key  - код кнопки



# Создание скелетной анимации

Для создания скелетной анимации необходимо создать несколько кадров в панели "сегментные спрайты";

Пример использования:


В цикле рисуем только те спрайты которые должны отображаться постоянно либо передаем пустой объект чтобы нарисовать фон, 
затем включаем две анимации 

      
      animationLop(sprites_group, 60, sprites); передаем глобальный объект спрайтов третьим аргументом 

      sprites_group.sceletl2.animation(sprites, 60); 
      sprites_group.sceletljjj.animation(sprites, 60);




**В цикле можно одновременно рисовать обычные спрайты и группу спрайтов:** 	  
  
  
**animationLop({name_group: spraites_group.group_656, name_sprite: spraites.sprite_657 }, 60, sprites)** 

или

var tiles=Object.assign({}, sprites_group);

modules.animation=animationLop(tiles,60,sprites); 

где в пустые кавычки ввести спрайты которые необходимо отображать на сцене 
пример {sprite_1: sprites.sprite_466, sprite_2: sprites.sprite_467, ....}



Также доступны функции:

**grop_name.getSize()** возвращает ширину и высоту группы [width, height]

**grop_name.hideShow(sprites, isShow)** - скрыть отобразить все привязанные спрайты данной группы
sprites - глобальный объект спрайтов, можно передать толь спрайты данной группы
	
**grop_name.nextFrame(index)** - включить следующий кадр, index - необязательный параметр если передать включит кадр по индексу
	
**grop_name.prevFrame(index)** - включить предыдущий кадр;
	
**grop_name.move(x, y)**  относительное передвижение группы спрайтов 
	
**grop_name.moveCenter(x, y,  )** передвижение группы спрайтов центром в указанную точку


**grop_name.moveConer(x, y, bootom)** передвижение группы спрайтов верхним левым углом в указанную точку
**bootom** - true - премещение нижним углом

После использования данных функций необходимо вызывать функцию  **grop_name.render_(sprites)** ,
либо отображать группу спрайтов в цикле **animationLop({name_group: spraites_group.group_656}, 60, sprites )** - третьим аргументом необходимо передать глобальный объект спрайтов 


**sprites_group.grop_name.animation(sprites, speed, callb, option)**;
где sprites - спрайты, speed - скорость анимации,  callb и option - функция обратного вызова и аргументы (необязательные параметры)


 


# Тестирование анимации 

<img src="https://github.com/Sergey1234Ovechkin/god_zilla/blob/main/img_study/test.png">

Нажать на правой панели кнопку code -> test затем загрузить проект анимации, нажать кнопку play

тестовый файл collagen_2/test/test_animation_layer.json


# Тестирование игр

Перейти в папку collagen_2/games/game_name

Запустить игру в консоли: node app или  forever start app.js

Для работы сетевых игр требуются библиотеки: socket.js и forever(глобальная инсталяция).


# Пошаговое руководство по созданию мини‐чата игрового формата



https://github.com/Sergey1234Ovechkin/god_zilla/wiki/Пошаговое-руководство-по-созданию-мини‐чата--игрового-формата


<img src="https://github.com/Sergey1234Ovechkin/god_zilla/blob/main/img_study/town.png">
